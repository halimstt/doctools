<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Statements Converter</title>
    <!-- Tailwind CSS CDN for utility classes -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Navigation script (remains separate as it's common) -->
    <script src="navigation.js"></script>
    <!-- PDF.js library for PDF parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <script>
      // Configure PDF.js worker source globally
      pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js`;
    </script>
    <!-- Google Fonts - Inter for a modern look -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* Base font and theme transition */
      body {
        font-family: "Inter", sans-serif;
        transition: background-color 0.3s ease, color 0.3s ease;
      }
      /* Specific styles for navigation placeholder, handled by navigation.js */
      #nav-placeholder {
        height: 64px;
        background-color: #ffffff;
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 1rem;
        box-sizing: border-box;
      }
      .dark #nav-placeholder {
        background-color: #1f2937;
      }
      /* Spinner animation styles */
      .loader {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #2563eb;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
      }
      .dark .loader {
        border-color: #374151;
        border-top-color: #60a5fa;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .spinner {
        animation: spin 1s linear infinite;
        border-top-color: white;
      }
      /* File input custom styling to hide native input */
      .file-input-wrapper {
        position: relative;
        overflow: hidden;
        display: inline-block;
        cursor: pointer;
      }
      .file-input-wrapper input[type="file"] {
        font-size: 100px;
        position: absolute;
        left: 0;
        top: 0;
        opacity: 0;
        cursor: pointer;
      }
      .file-input-button {
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }
      /* Modal overlay styles */
      .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1000; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgba(0, 0, 0, 0.4); /* Black w/ opacity */
        justify-content: center;
        align-items: center;
      }
      /* Modal content box styles */
      .modal-content {
        background-color: #fefefe;
        margin: auto;
        padding: 20px;
        border-radius: 8px;
        width: 90%;
        max-width: 500px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        position: relative;
      }
      .dark .modal-content {
        background-color: #1f2937;
        color: #f3f4f6;
      }
    </style>
  </head>
  <body
    class="bg-light-bg-primary text-light-text-primary dark:bg-dark-bg-primary dark:text-dark-text-primary"
  >
    <!-- Placeholder for navigation bar, populated by navigation.js -->
    <div id="nav-placeholder"></div>
    <div class="container max-w-5xl mx-auto p-4 sm:p-8">
      <header class="text-center mb-8">
        <h1
          class="text-3xl sm:text-4xl font-bold text-light-text-primary dark:text-dark-text-primary"
        >
          Statements Converter
        </h1>
        <p class="mt-2 text-light-text-secondary dark:text-dark-text-secondary">
          Select your statement type and upload your PDF files.
        </p>
      </header>

      <!-- Statement type selection dropdown -->
      <div class="mb-6 flex justify-center">
        <label for="parser-select" class="sr-only">Choose Statement Type</label>
        <select
          id="parser-select"
          class="block w-full sm:w-1/2 md:w-1/3 py-2 px-3 border border-light-border dark:border-dark-border bg-light-bg-secondary dark:bg-dark-bg-secondary rounded-md shadow-sm focus:outline-none focus:ring-accent-blue-light focus:border-accent-blue-light dark:focus:ring-accent-blue-dark dark:focus:border-accent-blue-dark sm:text-sm text-light-text-primary dark:text-dark-text-primary"
        >
          <option value="maybank-pdf">Maybank PDF Statement</option>
          <option value="maybank-web">Maybank Web Download</option>
          <option value="gemini-parser">Others (AI-Powered)</option>
        </select>
      </div>

      <!-- Message container for alerts (error/success) -->
      <div
        id="message-container"
        class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4 dark:bg-red-900 dark:border-red-700 dark:text-red-300"
        role="alert"
      >
        <strong id="message-prefix" class="font-bold"></strong>
        <span id="message-text" class="block sm:inline ml-2"></span>
        <span class="absolute top-0 bottom-0 right-0 px-4 py-3">
          <svg
            class="fill-current h-6 w-6 text-red-500 dark:text-red-400"
            role="button"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 20 20"
            onclick="hideMessage()"
          >
            <title>Close</title>
            <path
              d="M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.029a1.2 1.2 0 1 1 1.697 1.697L11.819 10l3.029 2.651a1.2 1.2 0 0 1 0 1.698z"
            />
          </svg>
        </span>
      </div>

      <main>
        <!-- File upload area (drag & drop or click) -->
        <div
          id="upload-area"
          class="border-2 border-dashed border-light-border dark:border-dark-border rounded-xl p-8 text-center bg-light-bg-secondary dark:bg-dark-bg-secondary transition-colors duration-300 ease-in-out"
        >
          <input
            type="file"
            id="file-input"
            class="hidden"
            accept=".pdf"
            multiple
          />
          <label for="file-input" id="upload-label" class="cursor-pointer">
            <div class="flex flex-col items-center">
              <svg
                class="w-16 h-16 text-gray-400 mb-4"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M12 16.5V9.75m0 0l-3 3m3-3l3 3M6.75 19.5a4.5 4.5 0 01-1.41-8.775 5.25 5.25 0 0110.233-2.33 3 3 0 013.758 3.848A3.752 3.752 0 0118 19.5H6.75z"
                />
              </svg>
              <p
                class="text-lg font-semibold text-light-text-secondary dark:text-dark-text-secondary"
              >
                Drag & drop your statement(s) here
              </p>
              <p class="text-gray-500 dark:text-gray-400">
                or
                <span
                  class="text-accent-blue-light dark:text-accent-blue-dark font-semibold"
                  >click to upload</span
                >
              </p>
            </div>
          </label>
          <!-- Display for selected files -->
          <div id="file-info" class="hidden text-left mt-4">
            <p
              class="font-semibold text-light-text-primary dark:text-dark-text-primary"
            >
              Selected Files:
            </p>
            <div
              id="file-pills-container"
              class="flex flex-wrap gap-2 mt-2"
            ></div>
            <button
              id="remove-all-files-btn"
              class="text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 font-semibold text-sm mt-2"
            >
              Remove All
            </button>
          </div>
        </div>

        <!-- Action buttons -->
        <div class="flex justify-center space-x-2 my-6">
          <button
            id="process-btn"
            class="w-full sm:w-auto bg-blue-500 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 disabled:opacity-20 disabled:cursor-not-allowed transition-all duration-300 ease-in-out flex items-center justify-center"
            disabled
          >
            <span id="process-btn-text">Process</span>
            <div
              id="spinner"
              class="spinner w-5 h-5 border-2 border-white border-t-transparent rounded-full ml-3 hidden"
            ></div>
          </button>
          <button
            id="download-btn"
            class="w-full sm:w-auto bg-blue-500 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 disabled:opacity-20 disabled:cursor-not-allowed transition-all duration-300 ease-in-out flex items-center justify-center"
            disabled
          >
            Download
          </button>
        </div>

        <!-- Processing status display -->
        <div id="status-container" class="mt-6 text-center text-sm">
          <p
            id="status-text"
            class="text-light-text-secondary dark:text-dark-text-secondary hidden"
          ></p>
        </div>

        <!-- Results table -->
        <div id="results-container" class="mt-12">
          <h2
            class="text-2xl font-bold text-light-text-primary dark:text-dark-text-primary mb-4"
          >
            Processed Results
          </h2>
          <div
            class="overflow-x-auto bg-light-bg-secondary dark:bg-dark-bg-secondary rounded-lg shadow"
          >
            <table class="w-full text-sm text-gray-500 dark:text-gray-400">
              <thead
                class="text-xs text-light-text-secondary dark:text-text-secondary uppercase bg-light-bg-primary dark:bg-dark-bg-primary bg-gray-200 dark:bg-gray-600"
              >
                <tr>
                  <th class="px-6 py-3">Date</th>
                  <th class="px-6 py-3">Description</th>
                  <th class="px-6 py-3">Amount</th>
                </tr>
              </thead>
              <tbody
                id="results-table-body"
                class="divide-y divide-light-border dark:divide-dark-border"
              >
                <tr>
                  <td colspan="3" class="px-6 py-4 text-center">
                    No documents processed yet.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </main>
    </div>

    <!-- Modal for Gemini API key input -->
    <div id="api-key-modal" class="modal">
      <div
        class="modal-content bg-light-bg-secondary dark:bg-dark-bg-secondary p-6 rounded-lg shadow-lg"
      >
        <h3
          class="text-xl font-bold mb-4 text-light-text-primary dark:text-dark-text-primary"
        >
          Enter Gemini API Key
        </h3>
        <p class="mb-4 text-light-text-secondary dark:text-dark-text-secondary">
          To use the Gemini AI-powered parser, please enter your Gemini API key.
          You can get one from
          <a
            href="https://aistudio.google.com/apikey"
            target="_blank"
            rel="noopener noreferrer"
            class="text-accent-blue-light dark:text-accent-blue-dark hover:underline"
            >Google AI Studio</a
          >.
        </p>
        <input
          type="text"
          id="gemini-api-key-input"
          class="w-full p-2 border border-light-border dark:border-dark-border rounded-md mb-4 bg-light-bg-primary dark:bg-dark-bg-primary text-light-text-primary dark:text-dark-text-primary focus:outline-none focus:ring-accent-blue-light focus:border-accent-blue-light dark:focus:ring-accent-blue-dark dark:focus:border-accent-blue-dark"
          placeholder="Enter your Gemini API key here"
        />
        <div class="flex justify-end gap-2">
          <button
            id="api-key-save-btn"
            class="bg-blue-600 text-white font-bold py-2 px-4 rounded-md hover:bg-blue-700 transition-colors"
          >
            Save Key
          </button>
          <button
            id="api-key-cancel-btn"
            class="bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-md hover:bg-gray-400 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600 transition-colors"
          >
            Cancel
          </button>
        </div>
      </div>
    </div>

    <!-- Link to the external JavaScript file -->
    <script src="index-script.js"></script>
  </body>
</html>
